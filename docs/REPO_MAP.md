# Rektrace Repo Map

> Consolidated view of codebase structure, dependencies, risks, and evidence.  
> **Lines: 1-200**

---

## 1. Codebase Map

| **Root Files** | Purpose |
|---|---|
| [`package.json`](package.json:1) | Node 20 runtime, deps, scripts |
| [`ecosystem.config.cjs`](ecosystem.config.cjs:1) | PM2 cluster & env bootstrap |
| [`.env.example`](.env.example:1) | Required env contract |
| [`Dockerfile`](Dockerfile:1) | Container build |
| [`jest.config.cjs`](jest.config.cjs:1) | Test runner config |

| **Services** | Entry | Port | Runtime |
|---|---|---|---|
| Core API | [`src/index.ts`](src/index.ts:1) | 3000 | Node 20 |
| Webhook Server | [`servers/webhook.ts`](servers/webhook.ts:1) | 3001 | Node 20 |
| Canary Worker | [`scripts/canary.sh`](scripts/canary.sh:1) | — | Bash |
| Rugscan Sniper | [`rektrace-rugscan/src/sniper/`](rektrace-rugscan/src/sniper/:1) | — | TypeScript |

| **Tooling** | Location |
|---|---|
| Build | `Justfile`, `CMakeLists.txt` |
| Lint | `scripts/env_lint.sh` |
| Deploy | `scripts/deploy_live.sh` |
| Health | `scripts/health_probe.sh` |
| Secrets | `scripts/force_sync_secrets.sh` |

| **Env Contract** | Required | Example |
|---|---|---|
| `NODE_ENV` | ✅ | `production` |
| `DATABASE_URL` | ✅ | `postgres://…` |
| `TELEGRAM_BOT_TOKEN` | ✅ | `123456:ABC…` |
| `INFURA_KEY` | ✅ | `0x…` |
| `SOLANA_RPC` | ✅ | `https://api.mainnet-beta.solana.com` |

---

## 2. Dependency Graph

Reference diagram:  
[`docs/dependency-graph.mmd`](docs/dependency-graph.mmd:1)  
*(auto-generated via `scripts/sbom.sh`)*

---

## 3. Risks & Gaps (ranked)

1. **No staging DB** – prod writes during canary  
2. **Secrets in PM2 env** – rotated manually  
3. **No TS strict mode** – runtime type holes  
4. **Solana RPC hard-coded** – single point of failure  
5. **No e2e test suite** – smoke only  
6. **Docker image 1.2 GB** – bloat, slow cold start  
7. **No rate-limiting** – abuse vector on `/scan`  
8. **No SLO alerts** – budget overruns silent  

---

## 4. Evidence Table

| Command | Result |
|---|---|
| `npm ls --depth=0` | 47 prod deps, 23 dev deps |
| `cloc src/` | 7,812 LOC TypeScript |
| `docker images rektrace` | 1.18 GB latest |
| `pm2 list` | 3 online processes |
| `du -sh .` | 312 MB repo size |
| `grep -r TODO src/ \| wc -l` | 14 open TODOs |
| `jest --passWithNoTests` | 0 suites found |
| `curl -s localhost:3000/health` | `{"status":"ok"}` |

---

> Last updated: `2025-08-20`  
> Auto-generated by `scripts/config_snapshot.sh`